"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8900],{98900:function(e,t,n){n.r(t),n.d(t,{FightScatterDemo:function(){return b}});var a=n(41922),i=n(91115),l=n(93635),s=n(46052),r=n(45114),o=n(83726),h=n(2823),c=n(78235);class d{async initPlaceholder(){try{let e=document.createElement("canvas");e.width=32,e.height=32;let t=e.getContext("2d");t&&(t.fillStyle="#95a5a6",t.beginPath(),t.arc(16,16,15,0,2*Math.PI),t.fill());let n=await new Promise(t=>{e.toBlob(t)});n&&(this.placeholderBitmap=await createImageBitmap(n))}catch(e){console.warn("Failed to create placeholder bitmap:",e)}}async createInitialsPlaceholder(e){try{let t=document.createElement("canvas");t.width=32,t.height=32;let n=t.getContext("2d");if(!n)return this.placeholderBitmap;let a=e.split("").reduce((e,t)=>t.charCodeAt(0)+((e<<5)-e),0);n.fillStyle="hsl(".concat(Math.abs(a)%360,", 65%, 50%)"),n.beginPath(),n.arc(16,16,15,0,2*Math.PI),n.fill();let i=e.trim().split(/\s+/),l="";i.length>=2?l=i[0][0]+i[i.length-1][0]:1===i.length&&(l=i[0].substring(0,2)),l=l.toUpperCase(),n.fillStyle="#ffffff",n.font="bold 12px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillText(l,16,16);let s=await new Promise(e=>{t.toBlob(e)});if(s)return await createImageBitmap(s);return this.placeholderBitmap}catch(e){return console.warn("Failed to create initials placeholder:",e),this.placeholderBitmap}}get(e){let t=this.cache.get(e);return t?(t.lastAccessed=Date.now(),t.bitmap):this.placeholderBitmap}set(e,t){this.cache.size>=this.maxSize&&this.evictLRU(),this.cache.set(e,{bitmap:t,lastAccessed:Date.now()})}evictLRU(){let e=null,t=1/0;for(let[n,a]of this.cache.entries())a.lastAccessed<t&&(t=a.lastAccessed,e=n);if(e){let t=this.cache.get(e);t&&(t.bitmap.close(),this.cache.delete(e))}}has(e){return this.cache.has(e)}isLoading(e){return this.loadingUrls.has(e)}async createCircularCrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];try{let a=document.createElement("canvas");a.width=t,a.height=t;let i=a.getContext("2d");if(!i)return null;let l=.5,s=.5;if(n)try{let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");if(n){n.drawImage(e,0,0);let t=n.getImageData(0,0,e.width,e.height),a=function(e){let{width:t,height:n,data:a}=e,i=t/16,l=n/16,s=[];for(let e=0;e<16;e++){s[e]=[];for(let t=0;t<16;t++)s[e][t]=0}for(let e=0;e<16;e++)for(let r=0;r<16;r++){let o=0,h=0,c=Math.floor(r*i),d=Math.floor(e*l),u=Math.min(Math.floor((r+1)*i),t),p=Math.min(Math.floor((e+1)*l),n);for(let e=d;e<p;e+=4)for(let i=c;i<u;i+=4){let l=(e*t+i)*4,s=.299*a[l]+.587*a[l+1]+.114*a[l+2];if(i>0&&e>0&&i<t-1&&e<n-1){let n=(e*t+(i+1))*4,l=.299*a[n]+.587*a[n+1]+.114*a[n+2],r=((e+1)*t+i)*4;o+=Math.abs(s-l)+Math.abs(s-(.299*a[r]+.587*a[r+1]+.114*a[r+2])),h++}}s[e][r]=h>0?o/h:0}for(let e=0;e<16;e++)for(let t=0;t<16;t++){let n=t-8,a=e-8,i=1+.3*(1-Math.sqrt(n*n+a*a)/8);s[e][t]*=i}let r=0,o=Math.floor(8),h=Math.floor(8);for(let e=0;e<16;e++)for(let t=0;t<16;t++)s[e][t]>r&&(r=s[e][t],o=t,h=e);return{x:(o+.5)/16,y:(h+.5)/16}}(t);l=a.x,s=a.y}}catch(e){console.warn("Face detection failed, using center crop:",e)}let r=Math.min(e.width,e.height),o=l*e.width-r/2,h=s*e.height-r/2,c=Math.max(0,Math.min(o,e.width-r)),d=Math.max(0,Math.min(h,e.height-r));i.save(),i.beginPath(),i.arc(t/2,t/2,t/2,0,2*Math.PI),i.clip(),i.drawImage(e,c,d,r,r,0,0,t,t),i.restore();let u=await new Promise(e=>{a.toBlob(e)});if(u)return await createImageBitmap(u);return null}catch(e){return console.warn("Failed to create circular crop:",e),null}}async loadBitmap(e){if(this.cache.has(e))return this.get(e);if(this.loadingUrls.has(e))return this.placeholderBitmap;this.loadingUrls.add(e);try{let t=await fetch(e);if(!t.ok)throw Error("Failed to fetch image: ".concat(t.statusText));let n=await t.blob(),a=await createImageBitmap(n);return this.set(e,a),a}catch(t){return console.warn("Failed to load bitmap from ".concat(e,":"),t),this.placeholderBitmap}finally{this.loadingUrls.delete(e)}}async loadBitmapWithCrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a="".concat(e,":crop:").concat(t,":").concat(n);if(this.cache.has(a))return this.get(a);let i=await this.loadBitmap(e);if(!i||i===this.placeholderBitmap)return i;let l=await this.createCircularCrop(i,t,n);return l?(this.set(a,l),l):i}async getOpponentBitmap(e,t,n){let a=await this.loadBitmap(t||"/img/opponents/".concat(e,"-32.webp"));if(a&&a!==this.placeholderBitmap)return a;if(n){let t="placeholder:".concat(e);if(this.has(t))return this.get(t);let a=await this.createInitialsPlaceholder(n);if(a&&a!==this.placeholderBitmap)return this.set(t,a),a}return this.placeholderBitmap}preloadBitmaps(e){let t=!1,n=[],a=[],i=()=>{t=!0,n.forEach(e=>clearTimeout(e)),a.forEach(e=>{"cancelIdleCallback"in window&&window.cancelIdleCallback(e)}),n.length=0,a.length=0},l=s=>{if(t||s>=e.length){i();return}let r=e[s];if(this.has(r)||this.isLoading(r)){if(t)return;if("requestIdleCallback"in window){let e=requestIdleCallback(()=>l(s+1));a.push(e)}else{let e=setTimeout(()=>l(s+1),16);n.push(e)}}else this.loadBitmap(r).then(()=>{if(!t){if("requestIdleCallback"in window){let e=requestIdleCallback(()=>l(s+1));a.push(e)}else{let e=setTimeout(()=>l(s+1),16);n.push(e)}}})};if("requestIdleCallback"in window){let e=requestIdleCallback(()=>l(0));a.push(e)}else{let e=setTimeout(()=>l(0),100);n.push(e)}return i}clear(){for(let e of this.cache.values())e.bitmap.close();this.cache.clear(),this.loadingUrls.clear(),this.placeholderBitmap&&(this.placeholderBitmap.close(),this.placeholderBitmap=null,this.initPlaceholder())}getStats(){return{size:this.cache.size,maxSize:this.maxSize,loading:this.loadingUrls.size}}constructor(e=256){this.cache=new Map,this.loadingUrls=new Set,this.placeholderBitmap=null,this.maxSize=e,this.initPlaceholder()}}let u=new d(256);var p=n(97976);let g={W:"#2ecc71",L:"#e74c3c",D:"#95a5a6"},f={KO:"KO/TKO",SUB:"Submission",DEC:"Decision",OTHER:"Other"};function m(e){var t,n,i;let{fight:l,x:s,y:r}=e,o=s>window.innerWidth/2?s-220:s+20,h=r>window.innerHeight/2?r-120:r+20;return(0,a.jsx)("div",{className:"pointer-events-none fixed z-50",style:{left:"".concat(o,"px"),top:"".concat(h,"px")},children:(0,a.jsxs)("div",{className:"rounded-lg border border-gray-700 bg-gray-900 p-3 shadow-xl",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center justify-between gap-3",children:[(0,a.jsx)("span",{className:"inline-block rounded px-2 py-0.5 text-xs font-bold text-white",style:{backgroundColor:g[l.result]},children:"W"===l.result?"WIN":"L"===l.result?"LOSS":"DRAW"}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:f[l.method]})]}),(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsxs)("div",{className:"text-sm font-semibold text-white",children:["vs ",l.opponent_name]})}),(0,a.jsx)("div",{className:"mb-1 text-xs text-gray-300",children:l.event_name}),(0,a.jsx)("div",{className:"mb-2 text-xs text-gray-400",children:(0,p.WU)(new Date(l.date),"MMM d, yyyy")}),(0,a.jsx)("div",{className:"text-xs text-gray-300",children:(t=l.method,n=l.round,i=l.time,"DEC"===t?"Decision":n&&i?"Round ".concat(n,", ").concat(i):"Unknown")}),l.fight_card_url&&(0,a.jsx)("div",{className:"mt-2 border-t border-gray-700 pt-2",children:(0,a.jsx)("a",{href:l.fight_card_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:text-blue-300 hover:underline",onClick:e=>e.stopPropagation(),children:"View on UFCStats →"})})]})})}let x={MARKER_SIZE:40,BORDER_WIDTH:2,BADGE_SIZE:12,COLORS:{WIN:"#2ecc71",LOSS:"#e74c3c",DRAW:"#95a5a6",TREND:"rgba(52, 152, 219, 0.6)",HEATMAP_COOL:"rgba(52, 152, 219, 0)",HEATMAP_WARM:"rgba(231, 76, 60, 0.4)"},FILTER_OPACITY:.15,ZOOM_EXTENT:[.5,5],HIT_TEST_RADIUS:25},w={KO:"KO",SUB:"SUB",DEC:"DEC",OTHER:"?"};function v(e){let{fights:t,hexbins:n,domainY:c,showDensity:d=!1,showTrend:p=!1,filterResults:g=[],filterMethods:f=[],onSelectFight:v,className:b="",height:y=600}=e,S=(0,i.useRef)(null),M=(0,i.useRef)(null),E=(0,i.useRef)(null),R=(0,i.useRef)(null),[C,N]=(0,i.useState)({width:800,height:y}),[I,j]=(0,i.useState)({scale:1,translateX:0,translateY:0}),[_,D]=(0,i.useState)(null),[k,O]=(0,i.useState)([]),[B,T]=(0,i.useState)(!1),L=(0,i.useRef)(null),z=(0,i.useMemo)(()=>{let e=function(e){if(0===e.length){let e=Date.now();return{xMin:e-31536e6,xMax:e,yMin:0,yMax:1500}}let t=1/0,n=-1/0,a=1/0,i=-1/0;for(let l of e){let e=new Date(l.date).getTime();t=Math.min(t,e),n=Math.max(n,e),a=Math.min(a,l.finish_seconds),i=Math.max(i,l.finish_seconds)}let l=(n-t)*.1,s=(i-a)*.1;return{xMin:t-l,xMax:n+l,yMin:Math.max(0,a-s),yMax:i+s}}(t);return{...e,yMin:c?c[0]:e.yMin,yMax:c?c[1]:e.yMax}},[t,c]),A=(0,i.useMemo)(()=>(0,l.Z)().domain([new Date(z.xMin),new Date(z.xMax)]).range([40,C.width-40]),[z.xMin,z.xMax,C.width]),P=(0,i.useMemo)(()=>(0,s.Z)().domain([z.yMax,z.yMin]).range([40,C.height-40]),[z.yMin,z.yMax,C.height]),U=(0,i.useMemo)(()=>t.map(e=>{let t=A(new Date(e.date))||0,n=P(e.finish_seconds)||0;return{...e,screenX:t*I.scale+I.translateX,screenY:n*I.scale+I.translateY}}),[t,A,P,I]),W=(0,i.useMemo)(()=>(0,o.Z)().x(e=>e.screenX).y(e=>e.screenY).addAll(U),[U]);(0,i.useEffect)(()=>{(async()=>{let e=t.map(e=>e.opponent_id?u.getOpponentBitmap(e.opponent_id,e.headshot_url,e.opponent_name):Promise.resolve(null));await Promise.all(e),T(!0)})()},[t]),(0,i.useEffect)(()=>{if("undefined"==typeof Worker)return;let e=new Blob(["\n      ".concat("\nclass Heap {\n  constructor(compare) {\n    this.compare = compare;\n    this.data = [];\n  }\n\n  push(value) {\n    this.data.push(value);\n    this.heapifyUp();\n  }\n\n  peek() {\n    return this.data[0];\n  }\n\n  pop() {\n    if (this.data.length === 0) return undefined;\n    const top = this.data[0];\n    const end = this.data.pop();\n    if (this.data.length > 0 && end !== undefined) {\n      this.data[0] = end;\n      this.heapifyDown();\n    }\n    return top;\n  }\n\n  size() {\n    return this.data.length;\n  }\n\n  heapifyUp() {\n    let index = this.data.length - 1;\n    while (index > 0) {\n      const parentIndex = Math.floor((index - 1) / 2);\n      if (this.compare(this.data[index], this.data[parentIndex]) >= 0) break;\n      [this.data[index], this.data[parentIndex]] = [this.data[parentIndex], this.data[index]];\n      index = parentIndex;\n    }\n  }\n\n  heapifyDown() {\n    let index = 0;\n    while (true) {\n      const left = index * 2 + 1;\n      const right = left + 1;\n      let smallest = index;\n\n      if (left < this.data.length && this.compare(this.data[left], this.data[smallest]) < 0) {\n        smallest = left;\n      }\n      if (right < this.data.length && this.compare(this.data[right], this.data[smallest]) < 0) {\n        smallest = right;\n      }\n      if (smallest === index) break;\n\n      [this.data[index], this.data[smallest]] = [this.data[smallest], this.data[index]];\n      index = smallest;\n    }\n  }\n}\n\nclass SlidingMedian {\n  constructor() {\n    this.lower = new Heap((a, b) => b - a);\n    this.upper = new Heap((a, b) => a - b);\n    this.lowerSize = 0;\n    this.upperSize = 0;\n    this.pendingRemovals = new Map();\n  }\n\n  add(value) {\n    if (this.lower.size() === 0 || value <= (this.lower.peek() ?? value)) {\n      this.lower.push(value);\n      this.lowerSize += 1;\n    } else {\n      this.upper.push(value);\n      this.upperSize += 1;\n    }\n    this.rebalance();\n  }\n\n  remove(value) {\n    this.pendingRemovals.set(value, (this.pendingRemovals.get(value) ?? 0) + 1);\n    if (this.lower.size() > 0 && value <= (this.lower.peek() ?? value)) {\n      this.lowerSize -= 1;\n      if (value === this.lower.peek()) this.prune(this.lower);\n    } else {\n      this.upperSize -= 1;\n      if (value === this.upper.peek()) this.prune(this.upper);\n    }\n    this.rebalance();\n  }\n\n  getMedian(windowLength) {\n    if (windowLength === 0) return 0;\n    this.prune(this.lower);\n    this.prune(this.upper);\n    if (windowLength % 2 === 1) return this.lower.peek() ?? 0;\n    const lowerValue = this.lower.peek() ?? 0;\n    const upperValue = this.upper.peek() ?? lowerValue;\n    return (lowerValue + upperValue) / 2;\n  }\n\n  prune(heap) {\n    while (heap.size() > 0) {\n      const value = heap.peek();\n      if (value === undefined) break;\n      const removals = this.pendingRemovals.get(value);\n      if (!removals) break;\n      if (removals === 1) {\n        this.pendingRemovals.delete(value);\n      } else {\n        this.pendingRemovals.set(value, removals - 1);\n      }\n      heap.pop();\n    }\n  }\n\n  rebalance() {\n    this.prune(this.lower);\n    this.prune(this.upper);\n    if (this.lowerSize > this.upperSize + 1) {\n      const value = this.lower.pop();\n      if (value !== undefined) {\n        this.upper.push(value);\n        this.lowerSize -= 1;\n        this.upperSize += 1;\n      }\n    } else if (this.upperSize > this.lowerSize) {\n      const value = this.upper.pop();\n      if (value !== undefined) {\n        this.lower.push(value);\n        this.upperSize -= 1;\n        this.lowerSize += 1;\n      }\n    }\n  }\n}\n\nfunction computeRollingMedian(points, windowSize = 5) {\n  if (points.length === 0) return [];\n  if (points.length <= windowSize) {\n    const sortedY = points.map((p) => p.y).sort((a, b) => a - b);\n    const medianY = sortedY[Math.floor(sortedY.length / 2)];\n    const medianX = points[Math.floor(points.length / 2)].x;\n    return [{ x: medianX, y: medianY }];\n  }\n\n  const smoothed = [];\n  const halfWindow = Math.floor(windowSize / 2);\n  const yValues = points.map((point) => point.y);\n  const slidingMedian = new SlidingMedian();\n\n  let currentStart = 0;\n  let currentEnd = 0;\n\n  for (let i = 0; i < points.length; i += 1) {\n    const targetStart = Math.max(0, i - halfWindow);\n    const targetEnd = Math.min(points.length, i + halfWindow + 1);\n\n    while (currentEnd < targetEnd) {\n      slidingMedian.add(yValues[currentEnd]);\n      currentEnd += 1;\n    }\n    while (currentStart < targetStart) {\n      slidingMedian.remove(yValues[currentStart]);\n      currentStart += 1;\n    }\n    while (currentEnd > targetEnd) {\n      currentEnd -= 1;\n      slidingMedian.remove(yValues[currentEnd]);\n    }\n\n    const medianY = slidingMedian.getMedian(targetEnd - targetStart);\n    smoothed.push({ x: points[i].x, y: medianY });\n  }\n\n  return smoothed;\n}\n",'\n\n      self.addEventListener("message", (event) => {\n        const { type, points, windowSize = 5 } = event.data;\n\n        if (type !== "compute") {\n          self.postMessage({\n            type: "error",\n            error: "Invalid message type",\n          });\n          return;\n        }\n\n        try {\n          // Ensure points are sorted by X\n          const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n          // Compute rolling median\n          const smoothedPoints = computeRollingMedian(sortedPoints, windowSize);\n\n          self.postMessage({\n            type: "result",\n            points: smoothedPoints,\n          });\n        } catch (error) {\n          self.postMessage({\n            type: "error",\n            error: error instanceof Error ? error.message : "Unknown error",\n          });\n        }\n      });\n    ')],{type:"application/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);L.current=n;let a=e=>{"result"===e.data.type&&e.data.points&&O(e.data.points)};return n.addEventListener("message",a),()=>{n.removeEventListener("message",a),n.terminate(),URL.revokeObjectURL(t),L.current=null}},[]),(0,i.useEffect)(()=>{if(p&&L.current&&t.length>0){let e=t.map(e=>({x:new Date(e.date).getTime(),y:e.finish_seconds}));L.current.postMessage({type:"compute",points:e,windowSize:7})}else O([])},[p,t]),(0,i.useEffect)(()=>{let e=S.current;if(!e)return;let t=new ResizeObserver(e=>{let t=e[0];t&&N({width:t.contentRect.width,height:y})});return t.observe(e),()=>t.disconnect()},[y]),(0,i.useEffect)(()=>{let e=R.current;if(!e)return;let t=(0,r.sP)().scaleExtent(x.ZOOM_EXTENT).on("zoom",e=>{let{k:t,x:n,y:a}=e.transform;j({scale:t,translateX:n,translateY:a})}),n=(0,h.Z)(e);return n.call(t),()=>{n.on(".zoom",null)}},[]),(0,i.useEffect)(()=>{if(!d||!n||0===n.length){let e=M.current;if(e){let t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height)}return}let e=M.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let a=window.devicePixelRatio||1;e.width=C.width*a,e.height=C.height*a,t.scale(a,a),t.clearRect(0,0,C.width,C.height);let i=Math.max(...n.map(e=>e.count));for(let e of n){let n=Math.sqrt(e.count/i);t.fillStyle="rgba(231, 76, 60, ".concat(.4*n,")");let a=50*e.i,l=50*e.j;t.fillRect(a,l,50,50)}},[d,n,C]);let Y=(0,i.useCallback)(()=>{let e=E.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let n=window.devicePixelRatio||1;e.width=C.width*n,e.height=C.height*n,t.scale(n,n),t.clearRect(0,0,C.width,C.height);let a=g.length>0||f.length>0;for(let e of U){let{screenX:n,screenY:i,result:l,method:s}=e,r=0===g.length||g.includes(l),o=0===f.length||f.includes(s),h=r&&o,c=a&&!h?x.FILTER_OPACITY:1,d=e.opponent_id?"placeholder:".concat(e.opponent_id):"",p=u.get(d)||u.get(e.headshot_url||""),m=x.MARKER_SIZE/2;if(t.save(),t.globalAlpha=c,t.beginPath(),t.arc(n,i,m,0,2*Math.PI),t.clip(),p?t.drawImage(p,n-m,i-m,x.MARKER_SIZE,x.MARKER_SIZE):(t.fillStyle="#95a5a6",t.fill()),t.restore(),t.save(),t.globalAlpha=c,t.strokeStyle="W"===l?x.COLORS.WIN:"L"===l?x.COLORS.LOSS:x.COLORS.DRAW,t.lineWidth=x.BORDER_WIDTH,t.beginPath(),t.arc(n,i,m,0,2*Math.PI),t.stroke(),t.restore(),"OTHER"!==s){let e=x.BADGE_SIZE,a=n+m-e-2,l=i-m+2;t.save(),t.globalAlpha=c,t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(a,l,e,e),t.fillStyle="#fff",t.font="8px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(w[s],a+e/2,l+e/2),t.restore()}if(e.opponent_name){let a=function(e){let t=e.trim().split(/\s+/);if(0===t.length)return"";if(1===t.length)return t[0];let n=t[0],a=t.slice(1).join(" ");return"".concat(n.charAt(0),". ").concat(a)}(e.opponent_name),l=i-m-8;t.save(),t.globalAlpha=c,t.shadowColor="rgba(0, 0, 0, 0.8)",t.shadowBlur=3,t.fillStyle="#fff",t.font="11px sans-serif",t.textAlign="center",t.textBaseline="bottom",t.fillText(a,n,l),t.restore()}}if(p&&k.length>1){t.save(),t.strokeStyle=x.COLORS.TREND,t.lineWidth=2,t.beginPath();for(let e=0;e<k.length;e++){let n=k[e],a=(A(new Date(n.x))||0)*I.scale+I.translateX,i=(P(n.y)||0)*I.scale+I.translateY;0===e?t.moveTo(a,i):t.lineTo(a,i)}t.stroke(),t.restore()}},[C,U,g,f,p,k,A,P,I]);(0,i.useEffect)(()=>{Y()},[Y]);let H=(0,i.useCallback)(e=>{var t;let n=null===(t=R.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;let a=e.clientX-n.left,i=e.clientY-n.top,l=W.find(a,i,x.HIT_TEST_RADIUS);l?D({x:e.clientX,y:e.clientY,fight:l}):D(null)},[W]),X=(0,i.useCallback)(()=>{D(null)},[]),F=(0,i.useCallback)(e=>{var t;if(!v)return;let n=null===(t=R.current)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;let a=e.clientX-n.left,i=e.clientY-n.top,l=W.find(a,i,x.HIT_TEST_RADIUS);l&&v(l.id)},[W,v]);return(0,a.jsxs)("div",{ref:S,className:"relative ".concat(b),children:[(0,a.jsxs)("div",{className:"relative",style:{width:"100%",height:"".concat(y,"px")},children:[(0,a.jsx)("canvas",{ref:M,className:"absolute left-0 top-0",style:{width:"100%",height:"100%"}}),(0,a.jsx)("canvas",{ref:E,className:"absolute left-0 top-0",style:{width:"100%",height:"100%"}}),(0,a.jsx)("svg",{className:"pointer-events-none absolute left-0 top-0",style:{width:"100%",height:"100%"},children:(()=>{let e=[],t=new Date(z.xMin),n=new Date(z.xMax),i=new Date(t.getFullYear(),t.getMonth(),1);for(;i<=n;){let t=(A(i)||0)*I.scale+I.translateX,n=i.getMonth(),l=i.getFullYear(),s=0===n,r=2===n||5===n||8===n;if(t>=0&&t<=C.width){let i=s?12:r?8:5,o=s?2.5:r?1.8:1,h=s?1:r?.8:.4,c=C.height-30;e.push((0,a.jsxs)("g",{children:[(0,a.jsx)("line",{x1:t,y1:c,x2:t,y2:c+i,stroke:"hsl(var(--border))",strokeWidth:o,opacity:h}),s&&(0,a.jsx)("text",{x:t,y:c+22,textAnchor:"middle",fill:"hsl(var(--muted-foreground))",fontSize:11,fontWeight:500,children:l})]},"tick-".concat(l,"-").concat(n)))}i.setMonth(i.getMonth()+1)}return e})()}),(0,a.jsx)("svg",{ref:R,className:"absolute left-0 top-0 cursor-move",style:{width:"100%",height:"100%"},onPointerMove:H,onPointerLeave:X,onClick:F})]}),_&&(0,a.jsx)(m,{fight:_.fight,x:_.x,y:_.y}),!B&&(0,a.jsx)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded-lg bg-gray-900/90 px-4 py-2 text-sm text-white",children:"Loading images..."})]})}function b(e){let{fightHistory:t}=e,[n,l]=(0,i.useState)(!1),[s,r]=(0,i.useState)(!0),[o,h]=(0,i.useState)([]),[d,u]=(0,i.useState)([]),p=t.map(e=>(function(e){var t,n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/img/placeholder-fighter.png",i=function(e){let t=e.toUpperCase();return t.includes("KO")||t.includes("TKO")||t.includes("KNOCKOUT")?"KO":t.includes("SUB")||t.includes("SUBMISSION")?"SUB":t.includes("DEC")||t.includes("DECISION")||t.includes("UNANIMOUS")||t.includes("SPLIT")||t.includes("MAJORITY")?"DEC":"OTHER"}(e.method),l=function(e){let t=e.toUpperCase().trim();return"W"===t||"WIN"===t?"W":"L"===t||"LOSS"===t||"LOSE"===t?"L":"D"===t||"DRAW"===t?"D":"L"}(e.result),s=(null===(t=e.event_name)||void 0===t?void 0:t.toLowerCase().includes("title"))?5:3,r=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;if(n||!e||!t)return 300*a;let i=t.split(":");if(2!==i.length)return 300*e;let l=parseInt(i[0],10),s=parseInt(i[1],10);return isNaN(l)||isNaN(s)?300*e:(e-1)*300+(60*l+s)}(e.round,e.time,"DEC"===i,s),o=e.opponent_id&&null!==(n=(0,c.CO)("/images/fighters/".concat(e.opponent_id,".jpg")))&&void 0!==n?n:a;return{id:e.fight_id,date:e.event_date||new Date().toISOString(),finish_seconds:r,method:i,result:l,opponent_id:e.opponent_id||null,opponent_name:e.opponent,headshot_url:o,event_name:e.event_name,round:e.round,time:e.time,fight_card_url:e.fight_card_url||null}})(e)),g=e=>{h(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},f=e=>{u(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>l(!n),className:"rounded px-3 py-1.5 text-sm font-medium transition-colors ".concat(n?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[n?"Hide":"Show"," Density"]}),(0,a.jsxs)("button",{onClick:()=>r(!s),className:"rounded px-3 py-1.5 text-sm font-medium transition-colors ".concat(s?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[s?"Hide":"Show"," Trend"]})]}),(0,a.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Results:"}),["W","L","D"].map(e=>(0,a.jsx)("button",{onClick:()=>g(e),className:"rounded px-2 py-1 text-xs font-medium transition-colors ".concat(0===o.length||o.includes(e)?"W"===e?"bg-green-600 text-white":"L"===e?"bg-red-600 text-white":"bg-gray-600 text-white":"bg-gray-200 text-gray-400"),children:"W"===e?"Wins":"L"===e?"Losses":"Draws"},e))]}),(0,a.jsx)("div",{className:"h-6 w-px bg-gray-300"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Methods:"}),["KO","SUB","DEC"].map(e=>(0,a.jsx)("button",{onClick:()=>f(e),className:"rounded px-2 py-1 text-xs font-medium transition-colors ".concat(0===d.length||d.includes(e)?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-400 hover:bg-gray-300"),children:e},e))]}),(o.length>0||d.length>0)&&(0,a.jsx)("button",{onClick:()=>{h([]),u([])},className:"text-sm text-blue-600 hover:text-blue-700 hover:underline",children:"Clear Filters"})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-gray-300 bg-white p-4",children:[(0,a.jsx)("div",{className:"mb-2 text-sm font-medium text-gray-700",children:"Fight History Timeline"}),(0,a.jsx)(v,{fights:p,showDensity:n,showTrend:s,filterResults:o,filterMethods:d,onSelectFight:e=>{console.log("Selected fight:",e)},height:600})]}),(0,a.jsxs)("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 rounded-full border-2 border-green-600"}),(0,a.jsx)("span",{children:"Win"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 rounded-full border-2 border-red-600"}),(0,a.jsx)("span",{children:"Loss"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 rounded-full border-2 border-gray-600"}),(0,a.jsx)("span",{children:"Draw"})]}),(0,a.jsx)("span",{className:"text-gray-400",children:"|"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Scroll to zoom • Drag to pan • Hover for details"})]})]})}}}]);